"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[763],{46679:function(Ge,G,n){n.r(G),n.d(G,{default:function(){return $e}});var _=n(15009),w=n.n(_),ee=n(99289),D=n.n(ee),ne=n(5574),te=n.n(ne),re=n(18814),A=n(62113),ae=n(5966),le=n(4942),ie=n(97685),Q=n(91),H=n(74165),oe=n(15861),o=n(1413),ue=n(51042),de=n(97462),ve=n(952),se=n(10915),ce=n(26369),W=n(22270),fe=n(48171),me=n(60249),he=n(71577),ge=n(58131),ye=n(21770),Re=n(88306),z=n(8880),g=n(67294),Ce=n(91060),l=n(85893),Ze=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],xe=["record","position","creatorButtonText","newRecordType","parentKey","style"],J=g.createContext(void 0);function Y(e){var R=e.children,x=e.record,S=e.position,K=e.newRecordType,F=e.parentKey,I=(0,g.useContext)(J);return g.cloneElement(R,(0,o.Z)((0,o.Z)({},R.props),{},{onClick:function(){var V=(0,oe.Z)((0,H.Z)().mark(function C(h){var Z,s,b,y;return(0,H.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(Z=(s=R.props).onClick)===null||Z===void 0?void 0:Z.call(s,h);case 2:if(y=d.sent,y!==!1){d.next=5;break}return d.abrupt("return");case 5:I==null||(b=I.current)===null||b===void 0||b.addEditRecord(x,{position:S,newRecordType:K,parentKey:F});case 6:case"end":return d.stop()}},C)}));function m(C){return V.apply(this,arguments)}return m}()}))}function U(e){var R,x,S=(0,se.YB)(),K=e.onTableChange,F=e.maxLength,I=e.formItemProps,V=e.recordCreatorProps,m=e.rowKey,C=e.controlled,h=e.defaultValue,Z=e.onChange,s=e.editableFormRef,b=(0,Q.Z)(e,Ze),y=(0,ce.D)(e.value),P=(0,g.useRef)(),d=(0,g.useRef)();(0,g.useImperativeHandle)(b.actionRef,function(){return P.current});var B=(0,ye.Z)(function(){return e.value||h||[]},{value:e.value,onChange:e.onChange}),k=(0,ie.Z)(B,2),u=k[0],we=k[1],j=g.useMemo(function(){return typeof m=="function"?m:function(c,t){return c[m]||t}},[m]),q=function(t){if(typeof t=="number"&&!e.name){if(t>=u.length)return t;var r=u&&u[t];return j==null?void 0:j(r,t)}if((typeof t=="string"||t>=u.length)&&e.name){var a=u.findIndex(function(i,v){var f;return(j==null||(f=j(i,v))===null||f===void 0?void 0:f.toString())===(t==null?void 0:t.toString())});return a}return t};(0,g.useImperativeHandle)(s,function(){var c=function(a){var i,v;if(a==null)throw new Error("rowIndex is required");var f=q(a),T=[e.name,(i=f==null?void 0:f.toString())!==null&&i!==void 0?i:""].flat(1).filter(Boolean);return(v=d.current)===null||v===void 0?void 0:v.getFieldValue(T)},t=function(){var a,i=[e.name].flat(1).filter(Boolean);if(Array.isArray(i)&&i.length===0){var v,f=(v=d.current)===null||v===void 0?void 0:v.getFieldsValue();return Array.isArray(f)?f:Object.keys(f).map(function(T){return f[T]})}return(a=d.current)===null||a===void 0?void 0:a.getFieldValue(i)};return(0,o.Z)((0,o.Z)({},d.current),{},{getRowData:c,getRowsData:t,setRowData:function(a,i){var v,f,T,N;if(a==null)throw new Error("rowIndex is required");var O=q(a),Le=[e.name,(v=O==null?void 0:O.toString())!==null&&v!==void 0?v:""].flat(1).filter(Boolean),Ne=((f=d.current)===null||f===void 0||(T=f.getFieldsValue)===null||T===void 0?void 0:T.call(f))||{},Oe=(0,z.Z)(Ne,Le,(0,o.Z)((0,o.Z)({},c(a)),i||{}));return(N=d.current)===null||N===void 0||N.setFieldsValue(Oe),!0}})}),(0,g.useEffect)(function(){e.controlled&&u.forEach(function(c,t){var r;(r=d.current)===null||r===void 0||r.setFieldsValue((0,le.Z)({},j(c,t),c))},{})},[u,e.controlled]),(0,g.useEffect)(function(){if(e.name){var c;d.current=e==null||(c=e.editable)===null||c===void 0?void 0:c.form}},[(R=e.editable)===null||R===void 0?void 0:R.form,e.name]);var $=V||{},Ie=$.record,M=$.position,Se=$.creatorButtonText,Ke=$.newRecordType,Ee=$.parentKey,De=$.style,Ae=(0,Q.Z)($,xe),p=M==="top",E=(0,g.useMemo)(function(){return F&&F<=(u==null?void 0:u.length)?!1:V!==!1&&(0,l.jsx)(Y,{record:(0,W.h)(Ie,u==null?void 0:u.length,u)||{},position:M,parentKey:(0,W.h)(Ee,u==null?void 0:u.length,u),newRecordType:Ke,children:(0,l.jsx)(he.ZP,(0,o.Z)((0,o.Z)({type:"dashed",style:(0,o.Z)({display:"block",margin:"10px 0",width:"100%"},De),icon:(0,l.jsx)(ue.Z,{})},Ae),{},{children:Se||S.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[V,F,u==null?void 0:u.length]),Be=(0,g.useMemo)(function(){return E?p?{components:{header:{wrapper:function(t){var r,a=t.className,i=t.children;return(0,l.jsxs)("thead",{className:a,children:[i,(0,l.jsxs)("tr",{style:{position:"relative"},children:[(0,l.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:E}),(0,l.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(r=b.columns)===null||r===void 0?void 0:r.length,children:E})]})]})}}}}:{tableViewRender:function(t,r){var a,i;return(0,l.jsxs)(l.Fragment,{children:[(a=(i=e.tableViewRender)===null||i===void 0?void 0:i.call(e,t,r))!==null&&a!==void 0?a:r,E]})}}:{}},[p,E]),L=(0,o.Z)({},e.editable),Me=(0,fe.J)(function(c,t){var r,a,i;if((r=e.editable)===null||r===void 0||(a=r.onValuesChange)===null||a===void 0||a.call(r,c,t),(i=e.onValuesChange)===null||i===void 0||i.call(e,t,c),e.controlled){var v;e==null||(v=e.onChange)===null||v===void 0||v.call(e,t)}});return(e!=null&&e.onValuesChange||(x=e.editable)!==null&&x!==void 0&&x.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(L.onValuesChange=Me),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(J.Provider,{value:P,children:(0,l.jsx)(Ce.Z,(0,o.Z)((0,o.Z)((0,o.Z)({search:!1,options:!1,pagination:!1,rowKey:m,revalidateOnFocus:!1},b),Be),{},{tableLayout:"fixed",actionRef:P,onChange:K,editable:(0,o.Z)((0,o.Z)({},L),{},{formProps:(0,o.Z)({formRef:d},L.formProps)}),dataSource:u,onDataSourceChange:function(t){if(we(t),e.name&&M==="top"){var r,a=(0,z.Z)({},[e.name].flat(1).filter(Boolean),t);(r=d.current)===null||r===void 0||r.setFieldsValue(a)}}}))}),e.name?(0,l.jsx)(de.Z,{name:[e.name],children:function(t){var r,a,i=(0,Re.Z)(t,[e.name].flat(1)),v=i==null?void 0:i.find(function(f,T){return!(0,me.A)(f,y==null?void 0:y[T])});return v&&y&&(e==null||(r=e.editable)===null||r===void 0||(a=r.onValuesChange)===null||a===void 0||a.call(r,v,i)),null}}):null]})}function X(e){var R=ve.ZP.useFormInstance();return e.name?(0,l.jsx)(ge.Z.Item,(0,o.Z)((0,o.Z)({style:{maxWidth:"100%"}},e==null?void 0:e.formItemProps),{},{name:e.name,children:(0,l.jsx)(U,(0,o.Z)((0,o.Z)({},e),{},{editable:(0,o.Z)((0,o.Z)({},e.editable),{},{form:R})}))})):(0,l.jsx)(U,(0,o.Z)({},e))}X.RecordCreator=Y;var Fe=X,be=n(4393),Te=n(2453),Pe=function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(x){setTimeout(function(){x(!0)},R)})},Ve=[{id:12345678,name:"\u6307\u6807",requirement:"\u8981\u6C42",unit:"\u5355\u4F4D",value:"\u503C",reducedAmount:"\u6263\u91CF"}],je=function(){var R=(0,g.useState)([]),x=te()(R,2),S=x[0],K=x[1],F=(0,g.useRef)(),I=(0,g.useRef)(),V=[{title:"\u6307\u6807\u9879\u540D\u79F0",dataIndex:"name",formItemProps:function(){return{rules:[{required:!0,message:"\u6B64\u9879\u4E3A\u5FC5\u586B\u9879"}]}}},{title:"\u6307\u6807\u8981\u6C42",dataIndex:"requirement",formItemProps:function(){return{rules:[{required:!0,message:"\u6B64\u9879\u4E3A\u5FC5\u586B\u9879"}]}}},{title:"\u5355\u4F4D",dataIndex:"unit"},{title:"\u6D4B\u91CF\u503C",dataIndex:"value"},{title:"\u6263\u91CF (%)",dataIndex:"reducedAmount"},{title:"\u64CD\u4F5C",valueType:"option",width:200,render:function(C,h,Z,s){return[(0,l.jsx)("a",{onClick:function(){var y;s==null||(y=s.startEditable)===null||y===void 0||y.call(s,h.id)},children:"\u7F16\u8F91"},"editable"),(0,l.jsx)("a",{onClick:function(){var y,P,d=(y=F.current)===null||y===void 0?void 0:y.getFieldValue("table");(P=F.current)===null||P===void 0||P.setFieldsValue({table:d.filter(function(B){return B.id!==h.id})})},children:"\u5220\u9664"},"delete")]}}];return(0,l.jsx)(re._z,{children:(0,l.jsxs)(be.Z,{children:[(0,l.jsxs)(A.L,{onFinish:function(){var m=D()(w()().mark(function C(h){return w()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:console.log(h),Te.ZP.success("\u63D0\u4EA4\u6210\u529F");case 2:case"end":return s.stop()}},C)}));return function(C){return m.apply(this,arguments)}}(),children:[(0,l.jsx)(A.L.StepForm,{name:"step1",title:"\u626B\u63CF\u6837\u54C1",grid:!0,rowProps:{gutter:16},onFinish:function(){var m=D()(w()().mark(function C(h){return w()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log(h),s.next=3,Pe(2e3);case 3:return s.abrupt("return",!0);case 4:case"end":return s.stop()}},C)}));return function(C){return m.apply(this,arguments)}}(),children:(0,l.jsx)(ae.Z,{name:"sampleId",label:"\u6837\u54C1\u5355\u53F7",placeholder:"\u8BF7\u8F93\u5165\u6837\u54C1\u5355\u53F7",colProps:{span:24}})}),(0,l.jsx)(A.L.StepForm,{name:"step2",formRef:F,title:"\u8D28\u91CF\u68C0\u9A8C",initialValues:{vehicleType:"truck"},rowProps:{gutter:16},children:(0,l.jsx)(Fe,{name:"table",editableFormRef:I,rowKey:"id",scroll:{x:960},recordCreatorProps:{position:"bottom",record:function(){return{id:(Math.random()*1e6).toFixed(0),name:""}}},request:D()(w()().mark(function m(){return w()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",{data:Ve,total:1,success:!0});case 1:case"end":return h.stop()}},m)})),loading:!1,columns:V,editable:{type:"multiple",editableKeys:S,onChange:K,actionRender:function(C,h,Z){return[Z.save,Z.delete||Z.cancel]}}})})]})," "]})})},$e=je}}]);
